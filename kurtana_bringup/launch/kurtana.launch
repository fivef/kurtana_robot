<?xml version="1.0"?>
<launch>

   <arg name="kinect_camera_name" default="kinect" />
   <arg name="stereo" default="false" />
   <arg name="flatten_table" default="true"/>

  <param name="katana_type" type="string" value="katana_300_6m180" />

    <!-- send kurtana urdf to param server -->
  <param name="robot_description" command="$(find xacro)/xacro.py '$(find kurtana_bringup)/urdf/kurtana.urdf.xacro'" />

  <!-- which joints does this katana instance control? -->
  <rosparam command="load" file="$(find katana)/config/katana_arm_controllers.yaml" />

  <!-- katana node -->
  <node pkg="katana" type="katana" name="katana" output="screen">
  	<param name="use_serial" type="bool" value="true" />
  	
  	    <!-- for /dev/ttyS0: -->
    <param name="serial_port" type="int" value="0" />
  
    <param name="config_file_path" type="string" value="$(find kni)/KNI_4.3.0/configfiles300/katana6M180.cfg" />
    
    <!-- Is Simulation? -->
    <param name="simulation" type="bool" value="true" />

    <!-- let the katana node publish on katana_joint_states -->
    <remap from="joint_states" to="katana_joint_states" />
    
    <!-- for katana_gripper_grasp_controller -->
    <remap from="posture_action_name" to="/gripper_grasp_posture_controller" />
    <remap from="grasp_query_name" to="/gripper_grasp_status" />
  </node>
  
    <!-- alternative option: database server running on a local machine -->
  <rosparam command="load" file="$(find household_objects_database)/config/wgs36.yaml"/>
  <node pkg="household_objects_database" name="objects_database_node" type="objects_database_node"
    respawn="true" output="screen"/>   
    
   <node name="cluster_bounding_box_finder" pkg="object_manipulator" cwd="node"
    type="cluster_bounding_box_finder_server.py" output="screen" respawn="false" >
    <param name="z_up_frame" value="/base_link" />
  </node>
    
    <!-- tabletop collision map processing -->
  <node pkg="tabletop_collision_map_processing" name="tabletop_collision_map_processing"
    type="tabletop_collision_map_processing_node" respawn="false" output="screen" />
  <param name="tabletop_collision_map_processing/get_model_mesh_srv"
    value="/objects_database_node/get_model_mesh" />
  <param name="tabletop_collision_map_processing/static_map_cloud_name" value="/kinect/depth_registered/points"/>
  
    <!-- tabletop segmentation and object recognition -->
  <include file="$(find tabletop_object_detector)/launch/tabletop_complete.launch">
    <arg unless="$(arg stereo)" name="tabletop_segmentation_points_input" value="$(arg kinect_camera_name)/depth_registered/points"/>
    <arg if="$(arg stereo)" name="tabletop_segmentation_points_input" value="narrow_stereo_textured/points2"/>
    <arg name="flatten_table" value="$(arg flatten_table)"/>
  </include>
  


  <!-- joint_commander: use dynamic_reconfigure to adjust the rack configuration manually -->
  <!-- node publishes on kurtana_joint_states -->
  <node name="joint_commander" pkg="kurtana_pole_joint_commander" type="joint_commander">
    <param name="kurtana_stretch_joint" type="double" value="0.135" />
    <param name="kurtana_roll_joint" type="double" value="0.02" />
    <param name="kurtana_pitch_joint" type="double" value="0.85" />

    <param name="publish_joint_states" type="bool" value="True" />
    <param name="publish_controller_commands" type="bool" value="True" />

    <remap from="joint_states" to="kurtana_joint_states" />
  </node>


  <!-- start the joint_state_muxer to merge the joint_states from the rack and the arm -->
  <rosparam param="source_list">[kurtana_joint_states, katana_joint_states, wheel_joint_states]</rosparam>
  <node pkg="joint_state_muxer" type="joint_state_muxer" name="joint_state_muxer" output="screen" />

  <!-- start the robot state publisher -->
  <node pkg="robot_state_publisher" type="state_publisher" name="robot_state_publisher" />

  <!-- Kinect driver -->
  <include file="$(find openni_launch)/launch/openni.launch">
    <arg name="camera" value="kinect" />
    <arg name="publish_tf" value="false" />
    <arg name="depth_registration" value="true" />
  </include>
  

  
  
</launch>

